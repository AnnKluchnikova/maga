#!/bin/bash

#Тема: Оценка производительности процессора.

# Определение модели процессора
cpu_model="$(lscpu | sed -n 13p)"

# Компиляция тестовой программы без ключей оптимизации
gcc lr2_testing_process.c -o test_o -lopenblas

# Компиляция тестовой программы с оптимизацией первого уровня
gcc lr2_testing_process.c -o test_o1 -O1 -lopenblas

# Компиляция тестовой программы с оптимизацией второго уровня
gcc lr2_testing_process.c -o test_o2 -O2 -lopenblas

# Задаем число испытаний типовых задач внутри тестовых программ
test_count=100

# Поочередный запуск тестовых программ
./test_o  -o 0 -m "${cpu_model:21}" -c ${test_count}
echo "____________________________________________________________________"
./test_o1 -o 1 -m "${cpu_model:21}" -c ${test_count}
echo "____________________________________________________________________"
./test_o2 -o 2 -m "${cpu_model:21}" -c ${test_count}
echo "____________________________________________________________________"

# Удаляем исполняемые файлы
rm test_*